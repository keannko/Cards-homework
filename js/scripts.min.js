import{cardsList}from"./cardsList.min.js";import{VisitCardiologist}from"./classes/VisitCardiologist.min.js";import{VisitDentist}from"./classes/VisitDentist.min.js";import{VisitTherapist}from"./classes/VisitTherapist.min.js";import{deleteCookie}from"./cookies.min.js";import{addCookie,getCookie}from"./cookies.min.js";import{displayCards}from"./displayCards.min.js";import{fetchCreateCard}from"./fetch/fetchCreateCard.min.js";import{fetchGetToken}from"./fetch/fetchGetToken.min.js";const enterButton=document.querySelector(".enter-button"),modalCloseBtn=document.querySelector(".close-btn"),createButton=document.querySelector(".create-button"),exitButton=document.querySelector(".exit-button"),loginButton=document.querySelector(".login-form__enterButton"),modal=document.querySelector(".modal-wrap");let authorizationToken;enterButton.addEventListener("click",e=>{modal.style.display="block"}),modalCloseBtn.addEventListener("click",e=>{modal.style.display="none"}),window.addEventListener("click",e=>{e.target===modal&&(modal.style.display="none")}),loginButton.addEventListener("click",async e=>{e.preventDefault();var e=document.querySelector(".login-form"),e=new FormData(e),t=document.querySelector(".error-msg"),o=(t.style.display="none",e.get("email")),e=e.get("password");"error"!==(authorizationToken=await fetchGetToken(o,e))&&addCookie("token",authorizationToken),"error"!==authorizationToken?(changeButton(),modal.style.display="none",cardsList()):t.style.display="flex"});const changeButton=()=>{enterButton.style.display="none",createButton.style.display="flex",exitButton.style.display="flex"},submitButton=(getCookie("token")&&(changeButton(),cardsList()),exitButton.addEventListener("click",e=>{document.querySelector(".card-filter-wrap").style.display="none",deleteCookie("token"),enterButton.style.display="flex",createButton.style.display="none",exitButton.style.display="none";var t=document.querySelector(".cards-list-wrapper");document.querySelectorAll(".client-card").forEach(e=>{e.remove()}),t.style.display="none"}),document.querySelector(".modal-buttons__create")),closeWindowButton=document.querySelector(".modal-buttons__close"),myModal=document.querySelector("#myModal"),select=document.querySelector("#doctor"),saveEditButton=document.querySelector(".modal-buttons__edit"),mainForm=(createButton.addEventListener("click",e=>{myModal.style.display="block",saveEditButton.style.display="none",mainForm.style.display="none",formCardiologist.style.display="none",formDentist.style.display="none",formGeneralPractitioner.style.display="none",select.selectedIndex=0}),closeWindowButton.addEventListener("click",e=>{myModal.style.display="none"}),window.addEventListener("click",e=>{e.target==myModal&&(myModal.style.display="none")}),document.querySelector(".main-form")),formCardiologist=document.querySelector(".cardiologist"),formDentist=document.querySelector(".dentist"),formGeneralPractitioner=document.querySelector(".generalPractitioner"),displayForm=(select.addEventListener("change",e=>{formCardiologist.style.display="none",formDentist.style.display="none",formGeneralPractitioner.style.display="none";var t=select.options[select.selectedIndex].value,o=document.querySelectorAll(".input");"cardiologist"===t||"dentist"===t||"generalPractitioner"===t?(mainForm.style.display="flex",o.forEach(e=>{e.value=""}),submitButton.style.display="flex",displayForm(select.selectedIndex)):mainForm.style.display="none"}),e=>{switch(e){case 1:formCardiologist.style.display="flex";break;case 2:formDentist.style.display="flex";break;case 3:formGeneralPractitioner.style.display="flex"}});submitButton.addEventListener("click",e=>{e.preventDefault();(async e=>{let t;var o=document.querySelector(".main-form"),n=document.querySelector("."+e),i=new FormData;let r=!1;for(const s of new FormData(o))i.append(s[0],s[1]);for(const l of new FormData(n))i.append(l[0],l[1]);for(const a of i.entries())a[1]||(r=!0,document.querySelector("#"+a[0]).classList.add("invalid"),setTimeout(()=>{document.querySelector("#"+a[0]).classList.remove("invalid")},1e3));r||(t="cardiologist"===e?new VisitCardiologist(i.get("visit"),i.get("about"),i.get("urgency"),i.get("name"),i.get("pressure"),i.get("massIndex"),i.get("diseases"),i.get("age"),1):"dentist"===e?new VisitDentist(i.get("visit"),i.get("about"),i.get("urgency"),i.get("name"),i.get("lastDate"),1):new VisitTherapist(i.get("visit"),i.get("about"),i.get("urgency"),i.get("name"),i.get("clientAge"),1),await fetchCreateCard(t),displayCards(t),myModal.style.display="none")})(doctor.value)});